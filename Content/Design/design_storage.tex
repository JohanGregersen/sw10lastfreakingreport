\subsubsection{Storage Server}\label{subsec:storageserver}
The storage server contains two layers: Trip-processing and physical storage.

The trip-processing layer handles the processing of new trips when it receives a stream of raw GPS data. The purpose of this layer is immensely specific, but the functionality it encapsulates is comprehensive. This layer is intentionally removed from the logic layer and placed on the storage server to optimize the use of computational resources. It also ensures the fastest possible retrieval and updating of data in the database, as the trip-processing layer can utilize localhost querying, removing any network communication overhead. The trip-processing layer uses the scoringmodel described in Section \ref{subsec:prereq} and other components referenced in \textit{An Advanced Usage Based Insurance And Privacy-Secure Pricing Model} \cite{sw9_report}. The layer completes seven steps to process a new trip, listed below:

\paragraph{Steps required to process a new trip}
\begin{itemize}
\item Deserialize from raw GPS data to C\# objects
\item Insert a new trip into the TripFact table of the database, and obtain the automatically assigned tripid
\item Insert the raw GPS coordinates and timestamp into the GPSFact table, setting the relevant carid and tripid for each row
\item Request map-matching from third party service, using the raw GPS coordinates \cite{trackmatch}. This requires the parsing of GPS coordinates into CSV-format, which becomes part of the request sent to the service. The service returns a set of road segments used on this trip, and the collection of map-matched GPS coordinates. Entries in the GPSFact table is then updated with the map-matched GPS coordinates, road segment ids and speed limits (if available).
\item Compute measures and flags for the entire trip in the GPSFact table. Measures are attributes like speed, acceleration, etc. Flags provides a true/false value to indicate whether the driver is speeding,  accelerating, etc. If duplicate timestamps are found in the collection of GPS points for a trip, these are pruned. Using a 1 second resolution makes such points relatively common, but also useless. It is impossible to compute measures with a division of 0 seconds as time passed since the previous point. The updated GPSFact entries are then updated in the GPSFact table with the computed measures and flags.
\item Compute the attributes in the TripFact entry: Length of trip, duration, optimal score, tripscore and the count of each delinquency, etc. The attributes in the TripFact entry are then updated in the database. The entire list of attributes can be seen in Figure \ref{app:fig:newdatawarehouse} in Appendices.
\item Check whether the car is enrolled in a competition, and if so, check whether the trip is valid for use in the competition. If it is, update the CompetingIn table, with the corresponding score and increased number of attempts. 
\end{itemize}

The physical storage layer is where the database is hosted. The database is a modified version of the data-warehouse schema presented in \textit{An Advanced Usage Based Insurance And Privacy-Secure Pricing Model} \cite{sw9_report}, hosted through the open source DBMS, PostgreSQL \cite{postgresql}. The modified data warehouse schema can be seen in Figure \ref{app:fig:newdatawarehouse} in Appendices.